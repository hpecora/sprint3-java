BEGIN
EXECUTE IMMEDIATE '
CREATE TABLE LOCALIZACAO (
                             ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
                             MOTO_ID    NUMBER      NOT NULL,
                             LATITUDE   NUMBER(9,6) NOT NULL,
                             LONGITUDE  NUMBER(9,6) NOT NULL,
                             DATA_HORA  TIMESTAMP   NOT NULL,
                             CONSTRAINT PK_LOCALIZACAO PRIMARY KEY (ID),
                             CONSTRAINT FK_LOCALIZACAO_MOTO FOREIGN KEY (MOTO_ID) REFERENCES MOTO(ID)
)';
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -955 THEN RAISE; END IF;
END;
/

BEGIN
EXECUTE IMMEDIATE 'CREATE INDEX IX_LOCALIZACAO_MOTO_DATA ON LOCALIZACAO (MOTO_ID, DATA_HORA)';
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE != -955 THEN RAISE; END IF;
END;
/
